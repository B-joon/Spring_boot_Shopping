# Entity

#### 엔티티 매핑 관련 어노테이션
| 어노테이션              | 설명                         |
|:-------------------|:---------------------------|
| @Entity            | 클래스를 엔티티로 선언               
| @Table             | 엔티티와 매핑할 테이블 지정            |
| @Id                | 테이블의 기본키에 사용할 속성을 지정       |
| @GeneratedValue    | 키 값을 생성하는 전략 명시            |
| @Column            | 필드와 컬럼 매핑                  |
| @Lob               | BLOB, CLOB 타입 매핑           |
| @CreationTimestamp | inset시 시간 자동 저장            |
| @UpdateTimestamp   | update시 시간 자동 저장           |
| @Enumerated        | enum 타입 매핑                 |
| @transient         | 해당 필드 데이터베이스 매핑 무시         |
| @Temporal          | 날짜 타입 매핑                   |
| @CreateDate        | 엔티티가 생성되어 저장될 때 시간 자동 저장   |
| @LastModifiedDate  | 조회한 엔티티의 값을 변경할 때 시간 자동 저장 |

#### CLOB와 BLOB의 의미
```
CLOB란 사이즈가 큰 데이터를 외부 파일로 저장하기 위한 데이터이다.
문자형 대용향 파일을 저장하는데 사용하는 데이터 타입이라고 생각하면 된다.
BLOB란 바이너리 데이터를 DB 외부에 저장하기 위한 타입이다. 이미지, 사운드, 비디오
같은 멀티 미디어 데이터를 다룰때 사용할 수 있다.
```

## @Column 속성
| 속성               | 설명                                                                                                               | 기본값       |
|:-----------------|:-----------------------------------------------------------------------------------------------------------------|:----------|
| name             | 필드와 매핑할 컬럼의 이름 설정                                                                                                | 객체의 필드 이름 |
| unique(DDL)      | 유니크 제약 조건 설정                                                                                                     |           |
| insertable       | insert 기능 여부                                                                                                     | true      |
| updatable        | update 기능 여부                                                                                                     | true      |
| length           | String 타입의 문자 길이 제약조건 설정                                                                                         | 255       |
| nullable         | null 값의 허용 여부 설정. false 설정 시 DDL 생성 시에 not null 제약조건 추가                                                          ||
| columnDefinition | 데이터베이스 컬럼 정보 직접 기술<br/>@Column(columnDefinition = "valchar(s)<br/>default'10' not null"                          ||
| precision        | BigDecimal 타입에서 사용(BingInteger 가능) precision은 소수점을 포함한 전체 자리수이고, scale은 소수점 자리수.<br/>Double과 float 타입에는 적용되지 않음. ||

#### DDL의 의미
```
DDL(Data Definition Language)이란 테이블, 스키마, 인덱스, 뷰, 도메인을 정의, 변경, 제거할 때 사용하는 언어이다.
가령, 테이블을 생성하거나 삭제하는 CREATE, DROP 등이 이에 해당한다.
```
@Entity 어노테이션은 클래스의 상단에 JPA에 언티티 클래스라는 것을 알려준다.
Entity 클래스는 반드시 기본키를 가져야해서 @Id 어노테이션을 이용해 id 맴버 변수를 상품 테이블의 기본키로 설정한다.

#### @GeneratedValue 기본키 생성하는 전략
| 생성 전략                         | 설명                                                                  |
|:------------------------------|:--------------------------------------------------------------------|
| GenerationType.AUTO (default) | JPA 구현체가 자동으로 생성 전략 결정                                              |
| GenerationType.IDENTITY       | 기본키 생성을 데이터베이스에 위임<br/>MySql 데이터베이스의 경우 AUTO_INCREMENT를 사용하여 기본키 생성 |
| GenerationType.SEQUENCE       | 데이터베이스 시퀀스 오브젝트를 이용한 기본키 생성<br/>@SequenceGenerator를 사용하여 시퀀스 등록 필요  |
| GenerationType.TABLE          | 키 생성용 테이블 사용. @TableGenerator 필요                                    |
전략은 기본키를 생성하는 방법이라고 이해하면 된다.

#### 기본키와 데이터베이스 시퀀스 오브젝트의 의미
````
기본키(primary key)는 데이터베이스에서 조건을 만족하는 튜플을 찾을 때 다른 튜플들과 유일하게 구별할 수 있도록
기준을 세워주는 속성입니다. 예를 들어 상품 데이터를 찾을 때 상품의 ID를 통해서 다른 상품들과
구별을 할 수 있다.
데이터베이스 시퀀스 오브젝트에서 시퀀스란 순차적으로 증가하는 값을 반환해주는 데이터베이스
객체입니다. 기본키 중복값을 방지하기 위해 사용한다.
````

# 연관 관계 매핑 종류
엔티티들은 대부분 다른 엔티티와 연관 관계를 맺고 있다.<br>
JPA에서는 엔티티에 연관 관계를 매핑해두고 필요할 때 해당 엔티티와 연관된 엔티티를 사용하여 좀 더 객체지향적으로 프로그래밍할 수 있도록 도와준다.

##### 매핑의 종류
 * 일대일(1:1): @OneToOne
 * 일대다(1:N): @OneToMany 
 * 다대일(N:1): @ManyToOne 
 * 다대다(N:N): @ManyToMany 

##### 매핑 방향
테이블에서 관계는 항상 양방향이지만, 객체에서는 단방향과 양방향이 존재한다.
 * 단방향
 * 양방향

##### 연관 관계 설정
 * 연관 관계의 주인은 외래키가 있는 곳으로 설정
 * 연관 관계의 주인이 외래키를 관리(등록, 수정, 삭제)
 * 주인이 아닌 쪽은 연관 관계 매핑 시 mappedBy 속성의 값으로 연관 관계의 주인을 설정<br>(ex/ @OneToMany(mappedBy = "entity명"))
 * 주인이 아닌 쪽은 읽기만 가능

##### 다대다 매핑 방법
````
@ManyToMany
@JoinTable(
    name = "테이블명",
    joinColumns = @JoinColumn(name = "테이블ID"),
    inverseJoinColumns = @JoinColumn(name = "테이블ID")
````

# 영속성 전이
'cascade' 사전적 정의는 '작은 폭포', '폭포처럼 흐르다'라는 뜻이 있다<br>
엔티티의 상태를 변경할 때 해당 엔티티와 연관된 엔티티의 상태 변화를 전파시키는 옵션이다.
이때 부모는 One에 해당하고 자식은 Many에 해당한다.

#### cascade의 종류
| cascade 종류 | 설명                                         |
|:-----------|:-------------------------------------------|
| PERSIST    | 부모 엔티티가 영속화될 때 자식 엔티티도 영속화                 |
| MERGE      | 부모 엔티티가 병합될 때 자식 엔티티도 병합                   |
| REMOVE     | 부모 엔티티가 삭제될 때 연관된 자식 엔티티도 삭제               |
| REFRESH    | 부모 엔티티가 refresh되면 연관된 자식 엔티티도 refresh      |
| DETACH     | 부모 엔티티가 detach되면 연관된 자식 엔티티도 detach 상태로 변경 |
| ALL        | 부모 엔티티의 영속성 상태 변화를 자식 엔티티에 모두 전이           |

영속성 전이 옵션을 무분별하게 사용할 경우 삭제되지 말아야 할 데이터가 삭제될 수 있으므로
조심해서 사용해야 한다. 영속성 전이 옵션은 단일 엔티티에 완전히 종속적이고 부모 엔티티와 자식 엔티티의
라이프 사이클이 유사할 때 cascade 옵션을 활용하는것이 좋다

### 고아 객체 제거
부모 엔티티와 연관 관계가 끊어진 자식 엔티티를 고아 객체라고 한다.
영속성 전이 기능과 같이 사용하면 부모 엔티티를 통해서 자식의 생명 주기를 관리할 수 있다.

##### 주의사항
 1. 참조하는 곳이 하나일 때만 사용해야 한다.
 2. 다른 곳에서도 참조하고 있는 엔티티인데 삭제하면 문제가 생길 수 있다.

# 자연 로딩
### 즉시 로딩(FetchType.EAGER)
일대일, 다대일로 매핑할 경우 기본 전략인 즉시 로딩을 통해 엔티티를 함께 가지고 온다.
즉, 작성하고 있는 비지니스 로직에서 사용하지 않을 데이터도 한꺼번에 들고 오는 것이다.

즉시 로딩을 사용할 경우 개발자는 쿼리가 어떻게 실행될지 예측할 수 없으며
사용하지 않는 데이터도 한꺼번에 조회하므로 성능 문제도 있을 수 있다. 그래서 실무에서 사용이 어려워서
즉시 로딩을 사용하는 대신 지연 로딩을 사용해야 한다.

### 지연 로딩(FetchType.LAZY)
지연 로딩으로 설정하면 실제 엔티티 대신에 프록시 객체를 넣어둔다.<br>
프록시 객체는 실제로 사용되기 전까지 데이터를 로딩하지 않고, 실제 사용 시점에 조회 쿼리문이 실해된다.

